<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Web Game </title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            background-color: #222;
            color: white;
            padding-top: 50px;
        }

        h1 {
            color: #f39c12;
        }

        .game-btn {
            display: inline-block;
            margin: 20px;
            padding: 20px 40px;
            font-size: 24px;
            color: white;
            background: #3498db;
            text-decoration: none;
            border-radius: 10px;
            transition: 0.3s;
        }

        .game-btn:hover {
            background: #2980b9;
            transform: scale(1.1);
        }

        .snake {
            background: #27ae60;
        }

        .dino {
            background: #e74c3c;
        }

        /* CSS cho B·∫£ng x·∫øp h·∫°ng */
        table {
            margin: 30px auto;
            width: 60%;
            border-collapse: collapse;
            background: #333;
        }

        th,
        td {
            padding: 12px;
            border-bottom: 1px solid #555;
        }

        th {
            background-color: #f39c12;
            color: black;
        }

        tr:hover {
            background-color: #444;
        }
    </style>
</head>

<body>

    <h1>üéÆ C·ªîNG GAME GI·∫¢I TR√ç üéÆ</h1>
    <p>Ch·ªçn tr√≤ ch∆°i:</p>

    <a href="/snake.html" class="game-btn snake">üêç R·∫Øn SƒÉn M·ªìi</a>
    <a href="/dino.html" class="game-btn dino">ü¶ñ Kh·ªßng Long Nh·∫£y</a>

    <div style="margin-top: 50px;">
        <h3>üèÜ B·∫¢NG X·∫æP H·∫†NG (TOP 10) üèÜ</h3>

        <table id="leaderboardTable">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Game</th>
                    <th>ƒêi·ªÉm s·ªë</th>
                    <th>Th·ªùi gian</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr>
                    <td colspan="4">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // H√†m g·ªçi API l·∫•y b·∫£ng x·∫øp h·∫°ng
        function loadLeaderboard() {
            fetch('/api/game/leaderboard')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('tableBody');
                    tbody.innerHTML = ""; // X√≥a d√≤ng "ƒêang t·∫£i..."

                    if (data.length === 0) {
                        tbody.innerHTML = "<tr><td colspan='4'>Ch∆∞a c√≥ ai ch∆°i c·∫£!</td></tr>";
                        return;
                    }

                    data.forEach(session => {
                        let date = new Date(session.playedAt).toLocaleString();
                        let row = `<tr>
                            <td>${session.username}</td>
                            <td>${session.gameType}</td>
                            <td style="color: #f1c40f; font-weight: bold;">${session.score}</td>
                            <td>${date}</td>
                        </tr>`;
                        tbody.innerHTML += row;
                    });
                })
                .catch(err => console.error("L·ªói t·∫£i b·∫£ng x·∫øp h·∫°ng:", err));
        }

        // G·ªçi h√†m khi trang v·ª´a t·∫£i xong
        loadLeaderboard();
    </script>
    <div id="userInfo" style="position: absolute; top: 20px; right: 20px; font-weight: bold;"></div>

    <script>
        // Ki·ªÉm tra xem ƒë√£ ƒëƒÉng nh·∫≠p ch∆∞a
        fetch('/api/auth/me')
            .then(response => {
                if (response.ok) return response.json();
                throw new Error("Ch∆∞a ƒëƒÉng nh·∫≠p");
            })
            .then(user => {
                // ƒê√£ ƒëƒÉng nh·∫≠p -> Hi·ªán t√™n v√† n√∫t ƒëƒÉng xu·∫•t
                document.getElementById("userInfo").innerHTML =
                    `Xin ch√†o, <span style="color:#f39c12">${user.username}</span> | 
                     <a href="#" onclick="logout()" style="color: #e74c3c; text-decoration: none;">ƒêƒÉng xu·∫•t</a>`;
            })
            .catch(() => {
                // Ch∆∞a ƒëƒÉng nh·∫≠p -> ƒê√° v·ªÅ trang login
                window.location.href = "/login.html";
            });

        function logout() {
            fetch('/api/auth/logout').then(() => window.location.reload());
        }

        // ... (Gi·ªØ nguy√™n code load b·∫£ng x·∫øp h·∫°ng c≈© ·ªü ƒë√¢y) ...
    </script>
</body>

</html>